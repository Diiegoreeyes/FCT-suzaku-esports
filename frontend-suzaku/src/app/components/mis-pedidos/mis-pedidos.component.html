<div class="mis-pedidos">
  <h2>Mis Pedidos</h2>

  <div *ngIf="pedidos && pedidos.length > 0; else noPedidos">
    <!-- Iteraci√≥n de cada pedido -->
    <div class="pedido-card" *ngFor="let pedido of pedidos">
      <div class="pedido-header">
        <h3>Pedido #{{ pedido.id }}</h3>
        <p class="estado">{{ pedido.estado }}</p>
      </div>

      <p class="fecha">Fecha: {{ pedido.fecha_creacion | date:'short' }}</p>

      <p class="codigo-descuento" *ngIf="pedido.codigo_descuento_str">
        C√≥digo utilizado: {{ pedido.codigo_descuento_str }}
      </p>

      <div class="pedido-totales">
        <ng-container *ngIf="pedido.descuento_aplicado && pedido.descuento_aplicado > 0; else sinDescuento">
          <p>
            <span class="precio-rojo-tachado">
              {{ pedido.total | currency:'EUR':'symbol':'1.2-2' }}
            </span>
            <span class="precio-descuento">
              {{ pedido.total_con_descuento | currency:'EUR':'symbol':'1.2-2' }}
            </span>
          </p>
          <p class="descuento">
            Descuento aplicado: {{ pedido.descuento_aplicado | currency:'EUR':'symbol':'1.2-2' }}
          </p>
        </ng-container>
        <ng-template #sinDescuento>
          <p class="precio-simple">
            {{ pedido.total | currency:'EUR':'symbol':'1.2-2' }}
          </p>
        </ng-template>
      </div>

      <!-- üîÅ Productos dentro de este pedido -->
      <div class="pedido-productos">
        <div class="producto-item" *ngFor="let item of pedido.productos">
          <img
            [src]="getProductoFoto(item.imagen_principal)"
            alt="{{ item.nombre }}"
            class="producto-img"
          />
          <div class="producto-info">
            <p class="producto-nombre"><strong>{{ item.nombre }}</strong></p>
            <p>Cantidad: {{ item.cantidad }}</p>
            <p>Precio unitario: {{ item.precio | currency:'EUR' }}</p>

            <p *ngIf="item.tipo">üß• Tipo: <strong>{{ item.tipo.nombre }}</strong></p>
            <p *ngIf="item.categoria">üè∑Ô∏è Categor√≠a: <strong>{{ item.categoria.nombre }}</strong></p>

            <div *ngIf="item.colores?.length">
              üé® Colores:
              <span *ngFor="let c of item.colores" class="badge-color" [style.backgroundColor]="c.codigo_hex || '#ddd'">
                {{ c.nombre }}
              </span>
            </div>

            <div *ngIf="item.tallas?.length">
              üìè Tallas:
              <span *ngFor="let t of item.tallas" class="badge-talla">{{ t.nombre }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <ng-template #noPedidos>
    <p>No tienes pedidos realizados.</p>
  </ng-template>
</div>
